USE_OCAMLFIND = true
OCAMLPACKS[] = ctypes.foreign
NATIVE_ENABLED = true
BYTE_ENABLED = true
OCAMLFLAGS = -g -w @A-4-29-41-44-45 -bin-annot -short-paths

mkdir -p _build
vmount(-l, src, _build)


.SUBDIRS: _build

    section:
	OCAML_OTHER_LIBS = unix
        FILES[] =
	    ev3_bluetooth
            ev3_comm
            ev3_protocol
            ev3_commands
            ev3_highlevel
            ev3


        OCamlLibrary(mindstorm-ev3, $(FILES))

        .PHONY: install uninstall
        install: ../META mindstorm-ev3.cmxa mindstorm-ev3.a mindstorm-ev3.cma

                ocamlfind remove mindstorm-ev3 || true
                ocamlfind install mindstorm-ev3 ../META $(addsuffix .c*, $(FILES)) $^
                touch $@

        uninstall:
		ocamlfind remove mindstorm-ev3 || true

    section:
	OCAML_LIBS = mindstorm-ev3
        OCamlProgram(main, main)

        .DEFAULT: main

.PHONY: clean
clean:
	rm -f -r _build
	rm -f *~
	rm -f .#*
	rm -f src/*~
	rm -f src/.#*
	rm -f *.omc
	rm -f *.lock
